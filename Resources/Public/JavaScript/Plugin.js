(()=>{var Y=Object.create;var x=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty;var J=(o,t)=>()=>(o&&(t=o(o=0)),t);var N=(o,t)=>()=>(t||o((t={exports:{}}).exports,t),t.exports);var Q=(o,t,c,h)=>{if(t&&typeof t=="object"||typeof t=="function")for(let d of $(t))!G.call(o,d)&&d!==c&&x(o,d,{get:()=>t[d],enumerable:!(h=q(t,d))||h.enumerable});return o};var T=(o,t,c)=>(c=o!=null?Y(z(o)):{},Q(t||!o||!o.__esModule?x(c,"default",{value:o,enumerable:!0}):c,o));function r(o){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${o}`])return window["@Neos:HostPluginAPI"][`@${o}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var u=J(()=>{});var v=N((xe,w)=>{u();w.exports=r("vendor")().React});var k=N((Ie,O)=>{u();O.exports=r("vendor")().reactRedux});var E=N((ve,W)=>{u();W.exports=r("NeosProjectPackages")().ReactUiComponents});var j=N((ke,L)=>{u();L.exports=r("NeosProjectPackages")().NeosUiReduxStore});var R=N((Ee,B)=>{u();B.exports=r("NeosProjectPackages")().NeosUiDecorators});u();var I=r("manifest");var i=T(v()),F=T(k()),y=T(E()),n=T(j()),K=T(R());u();var U=r("NeosProjectPackages")().NeosUiBackendConnectorDefault,{fetchWithErrorHandling:je}=r("NeosProjectPackages")().NeosUiBackendConnector;var A="Shel.Neos.SubTrees:SelectedTab",Z=(o,t,c)=>{let h=i.default.createElement(o,null),d=i.default.createElement(t,null);class H extends i.PureComponent{constructor(e){super(e);this.state={selectedPreset:"",getAvailablePresets:{}};this.fullReset=()=>{let e=this.getAvailablePresets(this.props);this.setState({selectedPreset:localStorage.getItem(A)||Object.keys(e)[0],availablePresets:e})};this.onActiveTabChange=async e=>{if(this.setState({selectedPreset:e}),localStorage.setItem(A,e),!e)return;let s=this.props.options.presets[e];s.rootNode&&this.focusRootNode(s.rootNode)};this.focusRootNode=async e=>{let s=e?e+"@"+this.props.siteNodeContextPath.split("@")[1]:null,a=this.props.getNodeByContextPath(s);if(a){this.focusNode(a);return}this.props.setAsLoading(s);let{q:m}=U.get();try{let p=m(s),f=await p.getForTree(),b="Neos.Neos:Document",g=await p.neosUiFilteredChildren(b).getForTree();if(f){let C=f.concat(g).reduce((P,S)=>(P[S.contextPath]=S,P),{});this.props.merge(C),a=this.props.getNodeByContextPath(s),this.focusNode(a)}}catch(p){console.error("failed getting preset rootnode",p)}finally{this.props.setAsLoaded(s)}};this.focusNode=e=>{this.props.focus(e.contextPath),this.props.setDocumentNode(e.contextPath),this.props.setActiveContentCanvasSrc(e.uri),(0,n.isNodeCollapsed)(e)&&this.props.toggle(e.contextPath)};let s=this.getAvailablePresets(e);this.state={selectedPreset:localStorage.getItem(A)||Object.keys(e.options.presets)[0],availablePresets:s};let a=e.options.presets[this.state.selectedPreset];a&&a.rootNode&&this.focusRootNode(a.rootNode)}getAvailablePresets({siteNodeContextPath:e,options:{presets:s}}){let a=e.split("@")[0];return Object.keys(s).reduce((m,p)=>{let f=s[p];return(!f.rootNode||f.rootNode.startsWith(a))&&(m[p]=f),m},{})}componentDidUpdate(e){(this.props.siteNodeContextPath!==e.siteNodeContextPath||this.props.baseWorkspaceName!==e.baseWorkspaceName)&&this.fullReset()}render(){let{i18nRegistry:e,siteNodeContextPath:s,getNodeByContextPath:a,getIsLoading:m}=this.props,{selectedPreset:p,availablePresets:f}=this.state;return i.default.createElement("div",{className:"tabbedPageTree_pageTreeContainer"},i.default.createElement("div",{className:"tabbedPageTree_pageTreeToolbar"},h),d,i.default.createElement(y.Tabs,{activeTab:p,onActiveTabChange:this.onActiveTabChange,theme:{tabs:"tabbedPageTree_tabs",tabs__content:"tabbedPageTree_tabs__content",tabs__panel:"tabbedPageTree_tabs__panel"}},Object.keys(f).map(b=>{let g=f[b],C=g.rootNode?g.rootNode+"@"+s.split("@")[1]:null,P={};return g.rootNode&&(P.rootNode=a(C)),i.default.createElement(y.Tabs.Panel,{id:b,key:b,icon:g.icon,title:g.title,tooltip:e.translate(g.tooltip),theme:{panel:"tabbedPageTree_panel"}},i.default.createElement(c,{...P}))})),m&&i.default.createElement("div",{className:"tabbedPageTree_pageTreeToolbar_loading"},i.default.createElement(y.Icon,{icon:"spinner",spin:!0})," Loading documents\u2026"))}}let M=(0,K.neos)(l=>({options:l.get("frontendConfiguration").get("Shel.Neos.SubTrees:TabbedPageTree"),i18nRegistry:l.get("i18n")})),V=(0,F.connect)(l=>({getNodeByContextPath:n.selectors.CR.Nodes.nodeByContextPath(l),getToggled:n.selectors.UI.PageTree.getToggled(l),getIsLoading:n.selectors.UI.PageTree.getIsLoading(l),siteNodeContextPath:l?.cr?.nodes?.siteNode,baseWorkspaceName:l?.cr?.workspaces?.personalWorkspace?.baseWorkspace}),{toggle:n.actions.UI.PageTree.toggle,focus:n.actions.UI.PageTree.focus,setAsLoading:n.actions.UI.PageTree.setAsLoading,setAsLoaded:n.actions.UI.PageTree.setAsLoaded,setActiveContentCanvasSrc:n.actions.UI.ContentCanvas.setSrc,merge:n.actions.CR.Nodes.merge,setDocumentNode:n.actions.CR.Nodes.setDocumentNode});return M(V(H))},D=Z;I("Shel.Neos.SubTrees:TabbedPageTree",{},o=>{let t=o.get("containers"),c=t.get("LeftSideBar/Top/PageTreeToolbar"),h=t.get("LeftSideBar/Top/PageTreeSearchbar"),d=t.get("LeftSideBar/Top/PageTree");t.set("LeftSideBar/Top/PageTreeToolbar",()=>null),t.set("LeftSideBar/Top/PageTreeSearchbar",()=>null),t.set("LeftSideBar/Top/PageTree",D(c,h,d))});})();
