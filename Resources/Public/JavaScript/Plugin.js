(()=>{var q=Object.create;var _=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var G=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var Q=(t,o)=>()=>(t&&(o=t(t=0)),o);var N=(t,o)=>()=>(o||t((o={exports:{}}).exports,o),o.exports);var X=(t,o,n,h)=>{if(o&&typeof o=="object"||typeof o=="function")for(let d of z(o))!J.call(t,d)&&d!==n&&_(t,d,{get:()=>o[d],enumerable:!(h=$(o,d))||h.enumerable});return t};var T=(t,o,n)=>(n=t!=null?q(G(t)):{},X(o||!t||!t.__esModule?_(n,"default",{value:t,enumerable:!0}):n,t));function r(t){return(...o)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${t}`])return window["@Neos:HostPluginAPI"][`@${t}`](...o);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var u=Q(()=>{});var O=N((_e,v)=>{u();v.exports=r("vendor")().React});var W=N((we,k)=>{u();k.exports=r("vendor")().reactRedux});var L=N((Oe,E)=>{u();E.exports=r("NeosProjectPackages")().ReactUiComponents});var B=N((We,j)=>{u();j.exports=r("NeosProjectPackages")().NeosUiReduxStore});var U=N((Le,R)=>{u();R.exports=r("NeosProjectPackages")().NeosUiDecorators});u();var w=r("manifest");var i=T(O()),K=T(W()),y=T(L()),c=T(B()),D=T(U());u();var F=r("NeosProjectPackages")().NeosUiBackendConnectorDefault,{fetchWithErrorHandling:Be}=r("NeosProjectPackages")().NeosUiBackendConnector;var x="Shel.Neos.SubTrees:SelectedTab",ee=(t,o,n,h)=>{let d=i.default.createElement(t,null),C=i.default.createElement(o,null);class M extends i.PureComponent{constructor(e){super(e);this.state={selectedPreset:"",getAvailablePresets:{}};this.fullReset=()=>{let e=this.getAvailablePresets(this.props);this.setState({selectedPreset:localStorage.getItem(x)||Object.keys(e)[0],availablePresets:e})};this.onActiveTabChange=async e=>{if(this.setState({selectedPreset:e}),localStorage.setItem(x,e),!e)return;let s=this.props.options.presets[e];s.rootNode&&this.focusRootNode(s.rootNode)};this.focusRootNode=async e=>{let s=e?e+"@"+this.props.siteNodeContextPath.split("@")[1]:null,a=this.props.getNodeByContextPath(s);if(a){this.focusNode(a);return}this.props.setAsLoading(s);let{q:m}=F.get();try{let l=m(s),f=await l.getForTree(),b="Neos.Neos:Document",g=await l.neosUiFilteredChildren(b).getForTree();if(f){let A=f.concat(g).reduce((P,S)=>(P[S.contextPath]=S,P),{});this.props.merge(A),a=this.props.getNodeByContextPath(s),this.focusNode(a)}}catch(l){console.error("failed getting preset rootnode",l)}finally{this.props.setAsLoaded(s)}};this.focusNode=e=>{if(this.props.focus(e.contextPath),this.props.setDocumentNode(e.contextPath),this.props.setActiveContentCanvasSrc(e.uri),!this.props.getToggled.includes(e.contextPath)&&e.depth-1>h){debugger;this.props.toggle(e.contextPath)}};let s=this.getAvailablePresets(e);this.state={selectedPreset:localStorage.getItem(x)||Object.keys(e.options.presets)[0],availablePresets:s};let a=e.options.presets[this.state.selectedPreset];a&&a.rootNode&&this.focusRootNode(a.rootNode)}getAvailablePresets({siteNodeContextPath:e,options:{presets:s}}){let a=e.split("@")[0];return Object.keys(s).reduce((m,l)=>{let f=s[l];return(!f.rootNode||f.rootNode.startsWith(a))&&(m[l]=f),m},{})}componentDidUpdate(e){(this.props.siteNodeContextPath!==e.siteNodeContextPath||this.props.baseWorkspaceName!==e.baseWorkspaceName)&&this.fullReset()}render(){let{i18nRegistry:e,siteNodeContextPath:s,getNodeByContextPath:a,getIsLoading:m}=this.props,{selectedPreset:l,availablePresets:f}=this.state;return i.default.createElement("div",{className:"tabbedPageTree_pageTreeContainer"},i.default.createElement("div",{className:"tabbedPageTree_pageTreeToolbar"},d),C,i.default.createElement(y.Tabs,{activeTab:l,onActiveTabChange:this.onActiveTabChange,theme:{tabs:"tabbedPageTree_tabs",tabs__content:"tabbedPageTree_tabs__content",tabs__panel:"tabbedPageTree_tabs__panel"}},Object.keys(f).map(b=>{let g=f[b],A=g.rootNode?g.rootNode+"@"+s.split("@")[1]:null,P={};return g.rootNode&&(P.rootNode=a(A)),i.default.createElement(y.Tabs.Panel,{id:b,key:b,icon:g.icon,title:g.title,tooltip:e.translate(g.tooltip),theme:{panel:"tabbedPageTree_panel"}},i.default.createElement(n,{...P}))})),m&&i.default.createElement("div",{className:"tabbedPageTree_pageTreeToolbar_loading"},i.default.createElement(y.Icon,{icon:"spinner",spin:!0})," Loading documents\u2026"))}}let V=(0,D.neos)(p=>({options:p.get("frontendConfiguration").get("Shel.Neos.SubTrees:TabbedPageTree"),i18nRegistry:p.get("i18n")})),Y=(0,K.connect)(p=>({getNodeByContextPath:c.selectors.CR.Nodes.nodeByContextPath(p),getToggled:c.selectors.UI.PageTree.getToggled(p),getIsLoading:c.selectors.UI.PageTree.getIsLoading(p),siteNodeContextPath:p?.cr?.nodes?.siteNode,baseWorkspaceName:p?.cr?.workspaces?.personalWorkspace?.baseWorkspace}),{toggle:c.actions.UI.PageTree.toggle,focus:c.actions.UI.PageTree.focus,setAsLoading:c.actions.UI.PageTree.setAsLoading,setAsLoaded:c.actions.UI.PageTree.setAsLoaded,setActiveContentCanvasSrc:c.actions.UI.ContentCanvas.setSrc,merge:c.actions.CR.Nodes.merge,setDocumentNode:c.actions.CR.Nodes.setDocumentNode});return V(Y(M))},H=ee;w("Shel.Neos.SubTrees:TabbedPageTree",{},(t,{configuration:o})=>{let n=t.get("containers"),h=n.get("LeftSideBar/Top/PageTreeToolbar"),d=n.get("LeftSideBar/Top/PageTreeSearchbar"),C=n.get("LeftSideBar/Top/PageTree");n.set("LeftSideBar/Top/PageTreeToolbar",()=>null),n.set("LeftSideBar/Top/PageTreeSearchbar",()=>null),n.set("LeftSideBar/Top/PageTree",H(h,d,C,o.nodeTree.loadingDepth))});})();
